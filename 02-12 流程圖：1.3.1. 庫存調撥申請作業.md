# 流程圖：1.3.1. 庫存調撥申請作業

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：1.3. 庫存調撥
* **文件狀態**：流程圖語法已更新為 Mermaid。

---

這份流程圖詳細描述了相關人員（如：倉管、專案經理）因應庫存平衡或專案需求，在系統中提出物料調撥申請的完整操作步驟。

### 流程圖說明

1.  **開始**：流程由申請人員進入「庫存調撥申請作業」功能頁面開始。
2.  **建立調撥單**：
    * 申請人員點擊「新增調撥單」按鈕。
3.  **填寫調撥資訊**：
    * **表頭**：申請人員需明確定義物料的來源與目的地，包含「來源專案/倉庫」、「目標專案/倉庫」及「調撥原因」。
    * **明細**：接著，逐一新增需要調撥的物料，包含「物料」、「調撥數量」以及要調撥的「來源儲位」與「批號」。
    * **(系統輔助)**：在選擇物料與儲位時，系統應即時顯示該儲位的「可用庫存數量」，防止申請的數量超過現有庫存。
4.  **提交申請**：
    * 確認所有調撥項目無誤後，申請人員點擊「提交申請」。
5.  **系統處理**：
    * 系統會先驗證資料的完整性，特別是檢查申請調撥的數量是否小於或等於來源儲位的庫存量。
    * 驗證通過後，系統會：
        * 自動產生一組唯一的「調撥單號 (`TransferNumber`)」。
        * 將申請資料存入 `Inventory.TransferHeaders` 與 `Inventory.TransferLines` 資料表。
        * 將該筆調撥單的 `Status` (狀態) 設為「待執行」或「待審核」（若流程需要審核）。
6.  **結束**：調撥申請單成功建立，等待後續的執行或審核作業。

### Mermaid 語法

```mermaid
flowchart TD
    subgraph 申請人員
        A1("開始: 進入庫存調撥申請作業") --> A2("點擊「新增調撥單」")
        A2 --> A3("填寫表頭資訊\n(來源/目標專案、倉庫等)")
        A3 --> A4("新增物料明細")
        A4 --> A5("選擇物料與來源\n• 系統自動帶出可用庫存量\n• 填寫調撥數量")
        A5 --> A6{檢查資料完整性?}
        A6 -- 未完成 --> A5
        A6 -- 完成 --> A7("點擊「提交申請」")
    end

    subgraph 系統處理
        B1{庫存驗證成功?}
        B1 -- 是 --> C1("產生調撥單號\n• 單據狀態:待審核\n• 凍結相應庫存")
        C1 --> C2("顯示成功訊息")
        B1 -- 否 --> D1("顯示明確錯誤:\n• 庫存不足\n• 批號錯誤等")
        D1 --> A5
    end

    subgraph 系統輔助
        B2["即時庫存提示:\n• 當前儲位可用量\n• 同物料其他儲位資訊"]
    end

    A5 -.-> B2
    A7 --> B1
    C2 --> Z(結束)
    style B2 fill:#f0f9ff,stroke:#333,stroke-dasharray:3 3