# 流程圖：2.3. 倉庫與儲位主檔維護作業

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：2. 主檔資料管理
* **文件狀態**：流程圖語法已更新為 Mermaid。

---

這份流程圖詳細描述了權責人員在系統中建立、查詢、修改及停用倉庫與儲位等實體位置主檔的完整操作步驟。

### 流程圖說明

1.  **開始**：流程由使用者進入「倉庫與儲位主檔維護作業」功能頁面開始。
2.  **查詢/修改/停用流程**：
    * 使用者可透過「倉庫名稱」、「儲位代碼」等條件查詢。
    * 系統以樹狀或列表形式，呈現倉庫與儲位的層級結構。
    * 使用者可選擇任一筆進行「修改」或「停用」。
3.  **新增流程 (核心)**：
    * 使用者點擊「新增」按鈕。
    * **步驟一：定義層級**：使用者需先決定要新增的是一個頂層的「倉庫」，還是在既有位置下的「子儲位」（如：儲區、貨架、儲格）。若為子儲位，需先選擇其「父儲位 (`ParentLocationID`)」。
    * **步驟二：填寫屬性**：接著填寫該位置的詳細資料，如「儲位名稱」、「儲位類型」（從下拉選單選擇）、物理尺寸、溫濕度要求等。
    * **步驟三：儲存**：使用者填寫完所有資訊後，點擊「儲存」。
4.  **系統處理 (新增)**：
    * 系統進行資料驗證。
    * 驗證通過後，系統會：
        * 根據使用者選擇的層級與輸入的資訊，**自動生成唯一的「儲位代碼 (`LocationCode`)」**（例如：`WH01-A-01-A`）。
        * 將新的位置資料存入 `Warehouse.Locations` 資料表。
5.  **結束**：倉庫或儲位主檔成功建立或更新。

### Mermaid 語法

```mermaid
---
title: 2.3. 倉庫與儲位主檔維護作業流程圖
---
flowchart TD
    %% Node Definitions
    subgraph 使用者
        A1("開始: 進入<br>倉庫/儲位主檔維護")
        A2{要新增？}

        A3("輸入查詢條件")
        A4("點擊「查詢」")
        A5("從結構中選擇一筆")
        A6{要修改？}
        A7("修改資料後<br>點擊「儲存」")
        A8("點擊「停用」")
        A9{確認？}
        
        A10("點擊「新增」")
        A11{是新增「倉庫」？}
        A12("填寫倉庫基本資料")
        A13("選擇父層級的倉庫或儲位<br>填寫子儲位基本資料")
        A14("填寫共通屬性<br>(類型、尺寸、溫濕度要求等)")
        A15("點擊「儲存」")
    end

    subgraph 系統
        B1("以樹狀或列表<br>顯示位置結構")
        B2("載入該位置的資料")
        B3("驗證並更新資料庫")
        B4("要求確認")
        B5("更新該位置狀態為「停用」")
        
        B6{資料驗證成功？}
        B8("顯示錯誤訊息")
        
        C1["根據層級與規則<br>自動生成「儲位代碼」"]
        C2["將資料存入<br>Warehouse.Locations 表"]
        B7("顯示「建立成功」訊息")
    end

    %% Link Definitions
    A1 --> A2

    %% Query/Modify/Disable Path
    A2 -- "否，查詢/修改/停用" --> A3 --> A4 --> B1 --> A5 --> A6
    A6 -- "是" --> B2 --> A7 --> B3 --> Z(結束)
    A6 -- "否，停用" --> A8 --> B4 --> A9
    A9 -- "是" --> B5 --> Z
    A9 -- "否" --> A5
    
    %% New Path
    A2 -- "是" --> A10 --> A11
    A11 -- "是" --> A12 --> A14
    A11 -- "否，新增「子儲位」" --> A13 --> A14
    A14 --> A15 --> B6
    
    B6 -- "是" --> C1 --> C2 --> B7 --> Z
    B6 -- "否" --> B8 --> A10