# 流程圖：2.1. 物料主檔維護作業

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：2. 主檔資料管理
* **文件狀態**：流程圖語法已更新為 Mermaid。

---

這份流程圖詳細描述了權責人員（如：資料管理員）在系統中建立、查詢、修改及停用物料主檔的完整操作步驟。

### 流程圖說明

1.  **開始**：流程由使用者進入「物料主檔維護作業」功能頁面開始。此頁面提供新增與查詢功能。
2.  **查詢/修改/停用流程**：
    * 使用者輸入查詢條件（如：物料編號、名稱、規格等）。
    * 系統顯示符合條件的物料列表。
    * 使用者可選擇任一筆物料進行「修改」或「停用」。
    * 若為修改：系統載入該物料的所有資料，使用者修改後儲存。
    * 若為停用：系統會要求確認，確認後將該物料的 `IsActive` 狀態設為「否」，而非直接刪除。
3.  **新增流程 (核心)**：
    * 使用者點擊「新增物料」按鈕。
    * **步驟一：分類選擇**：使用者需先選擇物料的「主分類」、「品牌」、「次分類」。
    * **步驟二：填寫共通資訊**：接著填寫物料名稱、單位、管理屬性（如：是否批號管理）等共通欄位。
    * **步驟三：填寫專有規格**：這是此流程最關鍵的一步。系統會根據第一步選擇的「主分類」，動態地顯示對應的規格輸入欄位（例如，選擇「塑膠管」，系統就顯示出 `Material.Spec_PlasticPipe` 的欄位如管徑、壁厚等）。
    * **步驟四：儲存**：使用者填寫完所有資訊後，點擊「儲存」。
4.  **系統處理 (新增)**：
    * 系統進行資料驗證。
    * 驗證通過後，系統會：
        * 根據「物料編碼原則」，結合使用者選擇的分類與填寫的規格，**自動生成唯一的22碼「物料編號 (`MaterialCode`)」**。
        * 將資料分別存入對應的資料表，包含 `Material.Masters` (主檔)、`Material.Spec_*` (對應的規格表)、`Material.Costs` (成本表) 等。
5.  **結束**：物料主檔成功建立或更新。

### Mermaid 語法

```mermaid
---
title: 2.1. 物料主檔維護作業流程圖
---
flowchart TD
    %% Node Definitions
    subgraph 使用者
        A1("開始: 進入<br>物料主檔維護作業")
        A2{要新增物料？}
        
        A3("輸入查詢條件")
        A4("點擊「查詢」")
        A5("從列表中選擇<br>一筆物料")
        A6{要修改？}
        A7("修改資料後<br>點擊「儲存」")
        A8("點擊「停用」")
        A9{確認？}
        
        A10("點擊「新增物料」")
        A11("1. 選擇主分類、品牌、次分類")
        A12("2. 填寫物料名稱、單位等<br>共通資訊")
        A13("3. 填寫專有規格")
        A14("4. 點擊「儲存」")
    end

    subgraph 系統
        B1("顯示符合條件的<br>物料列表")
        B2("載入物料完整資料")
        B3("驗證並更新資料庫")
        B4("要求確認")
        B5("更新物料狀態為「停用」")
        
        B6("根據選擇的分類，<br>動態顯示對應的規格欄位")
        B7{資料驗證成功？}
        B9("顯示錯誤訊息")
        
        C1["根據編碼原則生成<br>「物料編號」"]
        C2["將資料分別存入<br>Material.Masters, Material.Spec_*<br>等資料表"]
        B8("顯示「建立成功」訊息")
    end

    %% Link Definitions
    A1 --> A2

    %% Query/Modify/Disable Path
    A2 -- "否，查詢/修改/停用" --> A3
    A3 --> A4
    A4 --> B1
    B1 --> A5
    A5 --> A6

    A6 -- "是" --> B2
    B2 --> A7
    A7 --> B