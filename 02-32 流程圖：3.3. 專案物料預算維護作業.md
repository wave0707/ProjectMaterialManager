# 流程圖：3.3. 專案物料預算維護作業

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：3. 專案管理
* **文件狀態**：流程圖語法已更新為 Mermaid。

---

這份流程圖詳細描述了權責人員（如：專案經理、成本控制員）為特定專案建立及維護其物料採購預算的完整操作步驟。

### 流程圖說明

1.  **開始**：流程由使用者進入「專案物料預算維護作業」功能頁面開始。
2.  **選擇專案**：使用者必須先從列表中選擇一個要維護預算的專案。
3.  **載入預算**：系統會載入並顯示該專案最新版本的預算內容及其狀態（例如：草稿、已核准）。
4.  **版本與狀態控制**：
    * 如果預算的狀態是「已核准」，使用者若想修改，系統會提示是否要「建立新版本」。建立新版本後，使用者才能在新的草稿版本上進行編輯。
5.  **維護預算內容**：
    * **新增品項**：使用者可以新增一筆預算項目。預算可以設定在「物料次分類」的層級（如：管材類預算），也可以細化到「單一物料」的層級。使用者需填寫「預算金額」。
    * **修改品項**：使用者可以修改既有預算項目的「預算金額」。
    * **刪除品項**：使用者可以移除不再需要的預算項目。
6.  **儲存與提交**：
    * 使用者完成所有編輯後，點擊「儲存」。
    * 系統會將變更寫入 `Project.MaterialBudgetForecasts` 資料表。
    * 使用者可以選擇「提交審核」，將預算狀態變更為「待審核」，以進行後續的審批流程。
7.  **結束**：專案物料預算成功建立或更新。

### Mermaid 語法

```mermaid
---
title: 3.3. 專案物料預算維護作業流程圖
---
flowchart TD
    %% Node Definitions
    subgraph 使用者
        A1("開始: 進入<br>專案預算維護功能")
        A2("從列表中選擇一個專案")
        A3{狀態為「已核准」且想修改？}
        A4{確認建立新版本？}
        A5("新增/修改/刪除預算品項")
        A6("點擊「儲存」")
        A7{要提交審核？}
    end

    subgraph 系統
        B1("載入該專案最新版本的預算<br>及其狀態 (草稿/已核准)")
        B2("提示「是否建立新版本？」")
        B3("複製當前預算為新版本<br>(狀態: 草稿)")
        B4("將變更存入 `Project.MaterialBudgetForecasts` 表")
        B5("更新預算狀態為「待審核」")
    end

    Note1("<b>維護預算內容 (草稿狀態)</b><br>· 新增: 選擇物料分類/單一物料 -> 填寫金額<br>· 修改: 變更金額<br>· 刪除: 移除品項")

    %% Link Definitions
    A1 --> A2 --> B1
    B1 --> A3
    
    A3 -- "是" --> B2
    B2 --> A4
    A4 -- "是" --> B3
    B3 --> A5
    A4 -- "否" --> Z1(結束操作)
    
    A3 -- "否" --> A5
    
    A5 --> A6
    A6 --> B4
    B4 --> A7
    
    A7 -- "是" --> B5 --> Z2(結束)
    A7 -- "否" --> Z2
    
    A5 -.-> Note1
    style Note1 fill:#lightyellow,stroke:#333,stroke-dasharray: 5 5