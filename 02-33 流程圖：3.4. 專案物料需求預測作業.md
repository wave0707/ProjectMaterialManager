# 流程圖：3.4. 專案物料需求預測作業

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：3. 專案管理
* **文件狀態**：流程圖語法已更新為 Mermaid。

---

這份流程圖詳細描述了權責人員（如：專案經理、採購人員）如何透過系統分析，預測特定專案在未來一段時間內的物料需求缺口。

### 流程圖說明

1.  **開始**：流程由使用者進入「專案物料需求預測作業」功能頁面開始。
2.  **輸入條件**：使用者必須先選擇一個要進行預測的「專案」，並可選擇一個「預測期間」（例如：未來一個月、下一季）。
3.  **系統分析與計算**：
    * 使用者點擊「開始預測」後，系統會在背景執行一連串的計算。針對該專案BOM中的每一個物料：
        * **計算總需求量**：從 `Project.BOMs` 取得。
        * **計算已發料量**：從 `Inventory.MaterialIssuanceLines` 加總。
        * **計算剩餘需求量**：總需求量 - 已發料量。
        * **取得目前庫存量**：從 `Inventory.MaterialSummaries` 取得該專案的現有庫存。
        * **取得在途量**：查詢未完成的 `Procurement.OrderLines`，取得已採購但尚未到貨的數量。
        * **計算淨需求 (缺口)**：剩餘需求量 - 目前庫存量 - 在途量。
4.  **顯示預測報告**：
    * 系統將計算結果以報表形式呈現。報表會列出所有物料的預測狀況，清楚標示出有「缺口」的品項及其預計需求時間。
5.  **觸發採購 (可選)**：
    * 對於有缺口的物料，使用者可以直接從報表上勾選，並點擊「產生採購申請」，系統會將這些品項自動帶入採購申請單，簡化後續作業。
6.  **結束**：完成需求預測作業。

### Mermaid 語法

```mermaid
---
title: 3.4. 專案物料需求預測作業流程圖
---
flowchart TD
    %% Node Definitions
    subgraph 使用者
        A1("開始: 進入<br>專案物料需求預測功能")
        A2("選擇「專案」及「預測期間」")
        A3("點擊「開始預測」")
        A4{要產生採購申請？}
        A5("從報表中勾選缺料品項")
        A6("點擊「產生採購申請」")
    end

    subgraph "系統後台分析計算"
        B1["For each material in `Project.BOMs`:<br>· 計算總需求量<br>· 計算已發料量 (from `Inventory.MaterialIssuanceLines`)<br>· 計算剩餘需求量<br>· 取得目前庫存量 (from `Inventory.MaterialSummaries`)<br>· 取得在途量 (from `Procurement.OrderLines`)<br>· 計算淨需求 (缺口)"]
    end

    subgraph 系統
        B2["以報表形式顯示預測結果"]
        B3["將品項帶入新的採購申請單"]
    end

    subgraph Note1 [說明]
        N1["報表應標示出有缺口的物料"]
    end

    %% Link Definitions
    A1 --> A2
    A2 --> A3
    A3 --> B1
    
    B1 --> B2
    B2 --> A4
    
    A4 -- "是" --> A5
    A5 --> A6
    A6 --> B3
    B3 --> Z(結束)
    
    A4 -- "否" --> Z
    
    B2 -.-> Note1
    style Note1 fill:#lightyellow,stroke:#333,stroke-dasharray: 5 5