# 流程圖：1.4.3. 盤點結果登錄作業

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：1.4. 庫存盤點
* **文件狀態**：流程圖語法已更新為 Mermaid。

---

這份流程圖詳細描述了盤點人員在完成實體盤點後，將盤點清單上的實際數量登錄回系統的完整操作步驟。

### 流程圖說明

1.  **開始**：流程由盤點人員完成實體盤點後，進入「盤點結果登錄作業」功能頁面開始。
2.  **選擇盤點計畫**：
    * 系統會列出所有狀態為「執行中」的盤點計畫。
    * 盤點人員選擇與手上盤點清單對應的計畫。
3.  **登錄盤點數量**：
    * 系統顯示該計畫的盤點清單。
    * 盤點人員根據紙本或行動裝置上的紀錄，將每一個品項的「實際盤點數量」(`CountedQuantity`) 逐一輸入系統。
4.  **儲存盤點結果**：
    * 確認所有數量都已登錄無誤後，盤點人員點擊「儲存盤點結果」。
5.  **系統處理**：
    * 系統會針對每一筆登錄的項目，執行以下動作：
        * **抓取帳面量**：在當下凍結並抓取該物料/儲位/批號的系統帳面數量 (`SystemQuantity`)。
        * **計算差異**：計算「實際盤點數量」與「系統帳面數量」的差異 (`DifferenceQuantity`)。
        * **寫入結果表**：將盤點結果（含系統量、盤點量、差異量）寫入 `Inventory.CountResults` 資料表。
        * **標記狀態**：若存在差異，將該筆結果的 `AdjustmentStatus` (差異調整狀態) 標記為「待調整」。
6.  **結束**：盤點結果成功登錄。若有盤點差異，將觸發後續的「1.4.4. 盤點差異調整作業」。

### Mermaid 語法

```mermaid
---
title: 1.4.3. 盤點結果登錄作業流程圖
---
flowchart TD
    %% Node Definitions
    subgraph 盤點人員
        A1("開始: 進入<br>盤點結果登錄作業")
        A2("從列表中選擇<br>對應的盤點計畫")
        A3("逐一輸入各品項的<br>「實際盤點數量」")
        A4("點擊「儲存盤點結果」")
    end

    subgraph 系統
        B1("顯示所有「執行中」的<br>盤點計畫")
        B2("顯示該計畫的盤點清單")
        B3["針對每個品項：<br>· 抓取當下系統帳面數量<br>· 計算盤點差異<br>· 將結果寫入盤點結果表 (Inventory.CountResults)<br>· 若有差異，標記為「待調整」"]
        B4("顯示「結果登錄成功」訊息")
    end
    
    subgraph Note1 [說明]
        N1["若有差異，將觸發後續調整流程"]
    end

    %% Link Definitions
    A1 --> B1
    B1 --> A2
    A2 --> B2
    B2 --> A3
    A3 --> A4
    A4 --> B3
    B3 --> B4
    
    B4 -.-> Note1
    style Note1 fill:#lightyellow,stroke:#333,stroke-dasharray: 5 5
    
    B4 --> Z(結束)