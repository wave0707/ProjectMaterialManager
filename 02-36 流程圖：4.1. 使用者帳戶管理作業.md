# 流程圖：4.1. 使用者帳戶管理作業

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：4. 使用者與權限管理
* **文件狀態**：流程圖語法已更新為 Mermaid。

---

這份流程圖詳細描述了系統管理員在系統中建立、查詢、修改及停用使用者帳戶的完整操作步驟。

### 流程圖說明

1.  **開始**：流程由系統管理員進入「使用者帳戶管理作業」功能頁面開始。
2.  **查詢/修改/停用流程**：
    * 管理員可透過「使用者名稱」、「姓名」、「所屬公司/部門」等條件查詢。
    * 系統顯示符合條件的使用者列表。
    * 管理員可選擇任一筆使用者進行「修改」或「停用」。
3.  **新增流程 (核心)**：
    * 管理員點擊「新增使用者」按鈕。
    * **步驟一：填寫基本資料**：管理員需填寫使用者的「登入帳號」、「預設密碼」、「姓名」、「Email」等。
    * **步驟二：定義組織歸屬**：選擇該使用者所屬的「公司」與「部門」。
    * **步驟三：定義使用者類型**：選擇是「內部員工」還是「外部廠商」。若為外部廠商，需填寫其公司名稱等相關資訊。
    * **步驟四：指派角色**：從系統既有的角色列表中，勾選一或多個角色指派給此使用者。
    * **步驟五：儲存**：管理員填寫完所有資訊後，點擊「儲存」。
4.  **系統處理 (新增)**：
    * 系統進行資料驗證。
    * 驗證通過後，系統會：
        * 將新的使用者資料存入 `Security.Users` 資料表。
        * 將使用者與角色的對應關係存入 `Security.UserRoles` 關聯表。
5.  **結束**：使用者帳戶成功建立或更新。

### Mermaid 語法

```mermaid
---
title: 4.1. 使用者帳戶管理作業流程圖
---
flowchart TD
    %% Node Definitions
    subgraph 系統管理員
        A1("開始: 進入<br>使用者帳戶管理")
        A2{要新增使用者？}

        A3("輸入查詢條件")
        A4("點擊「查詢」")
        A5("從列表中選擇<br>一筆使用者")
        A6{要修改？}
        A7("修改資料後<br>點擊「儲存」")
        A8("點擊「停用」")
        A9{確認？}
        
        A10("點擊「新增使用者」")
        A11("1. 填寫基本資料<br>(帳號/密碼/姓名)")
        A12("2. 選擇所屬公司/部門")
        A13("3. 選擇使用者類型<br>(內部/外部)")
        A14("4. 指派系統角色")
        A15("5. 點擊「儲存」")
    end

    subgraph 系統
        B1("顯示符合條件的<br>使用者列表")
        B2("載入使用者完整資料")
        B3("驗證並更新資料庫")
        B4("要求確認")
        B5("更新使用者狀態為「停用」")
        
        B6{資料驗證成功？}
        B8("顯示錯誤訊息")
        
        C1["將資料存入<br>Security.Users 表"]
        C2["將角色關係存入<br>Security.UserRoles 表"]
        B7("顯示「建立成功」訊息")
    end

    %% Link Definitions
    A1 --> A2

    %% Query/Modify/Disable Path
    A2 -- "否，查詢/修改/停用" --> A3 --> A4 --> B1 --> A5 --> A6
    A6 -- "是" --> B2 --> A7 --> B3 --> Z(結束)
    A6 -- "否，停用" --> A8 --> B4 --> A9
    A9 -- "是" --> B5 --> Z
    A9 -- "否" --> A5
    
    %% New Path
    A2 -- "是" --> A10 --> A11 --> A12 --> A13 --> A14 --> A15 --> B6
    B6 -- "是" --> C1 --> C2 --> B7 --> Z
    B6 -- "否" --> B8 --> A10