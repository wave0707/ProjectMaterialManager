# 流程圖：1.1.4. 入庫確認作業

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：1.1. 入庫管理
* **文件狀態**：Mermaid 語法已修正。

---

這份流程圖詳細描述了倉管主管在確認物料品質與數量無誤後，執行系統入庫並**正式更新庫存**的最終步驟。

### 流程圖說明

1.  **開始**：流程由倉管主管或權責人員進入「入庫確認作業」功能頁面開始。
2.  **查詢待確認項目**：
    * 系統會自動列出所有已完成收貨登錄、且品質狀態為「合格」或「特採合格」的收貨單。
    * 主管可以透過收貨單號等條件進行篩選。
3.  **執行確認**：
    * 主管從列表中選擇一筆或多筆準備確認入庫的收貨單。
    * 點擊「確認入庫」按鈕。
4.  **系統庫存異動**：
    * 這是整個流程的核心，系統會在背景執行一連串的資料庫更新，以確保資料的一致性：
        * **更新收貨單狀態**：將 `Inventory.GoodsReceiptHeaders` 的單據狀態從「暫存」更新為「已確認」。
        * **寫入庫存異動日誌**：在 `Inventory.TransactionLogs` 中，為每一筆確認的物料新增一筆 `TransactionType` 為「入庫」的紀錄，`QuantityChange` 為正數。這是所有庫存計算的原始憑證。
        * **更新即時庫存**：根據異動日誌，更新 `Inventory.LotDetails` 中對應的物料在特定儲位、特定批號下的即時庫存數量 (`QuantityOnHand`)。
        * **更新庫存總表**：同步更新 `Inventory.MaterialSummaries` 中的物料庫存總量，以利報表快速查詢。
5.  **結束**：系統顯示「入庫成功」訊息，該批物料正式成為系統中的可用庫存。

### Mermaid 語法

```mermaid
---
title: 1.1.4. 入庫確認作業流程圖
---
flowchart TD
    subgraph 倉管主管
        A1("開始: 進入<br>入庫確認作業") --> B1
        B1 --> A2["從列表中選擇<br>一筆或多筆收貨單"] --> A3["點擊「確認入庫」"] --> B2
        B2 --> A4{確認執行？}
    end

    subgraph 系統
        B1["顯示所有待確認的<br>收貨單列表"]
        B2["顯示確認對話框"]
        B3("返回待確認列表") --> A1
        B4["顯示「入庫成功」訊息"] --> Z(結束)
    end
    
    subgraph "系統後台作業"
        C1["更新收貨單主檔<br>(Inventory.GoodsReceiptHeaders)<br>狀態為「已確認」"]
        C2["新增庫存異動日誌<br>(Inventory.TransactionLogs)<br>交易類型為「入庫」"]
        C3["更新庫存明細<br>(Inventory.LotDetails)<br>增加庫存數量"]
        C4["更新庫存總表<br>(Inventory.MaterialSummaries)<br>增加物料總庫存"]
    end
    
    A4 -- "是" --> C1 --> C2 --> C3 --> C4 --> B4
    A4 -- "否" --> B3