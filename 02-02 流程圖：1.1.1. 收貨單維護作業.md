# 流程圖：1.1.1. 收貨單維護作業

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：1.1. 入庫管理
* **文件狀態**：流程圖語法已更新為 Mermaid。

---

這份流程圖詳細描述了倉管人員在系統中進行「收貨單維護」的完整操作步驟，包含新增、查詢、修改與作廢一張收貨單。

### 流程圖說明

1.  **開始**：流程由倉管人員進入「收貨單維護作業」功能頁面開始。
2.  **選擇操作**：使用者可以選擇要「新增收貨單」、「查詢/修改」既有收貨單，或是「作廢」收貨單。
3.  **新增流程**：
    * 使用者點擊「新增」按鈕。
    * 系統呈現一張空白的收貨單表單。
    * 使用者填寫表頭資訊（如：供應商、關聯專案、收貨日期）與明細資訊（如：物料、收貨數量、存放儲位、批號等）。
    * 使用者點擊「儲存」。
    * 系統進行資料驗證。
    * 若驗證通過，系統會自動產生一組唯一的「收貨單號 (`GoodsReceiptNumber`)」，並將資料寫入 `Inventory.GoodsReceiptHeaders` 與 `Inventory.GoodsReceiptLines` 資料表，單據狀態設為「暫存」。
    * 若驗證失敗，則提示錯誤訊息，讓使用者修正。
4.  **查詢/修改流程**：
    * 使用者輸入查詢條件（如：收貨單號、日期區間、供應商）。
    * 系統根據條件顯示符合的收貨單列表。
    * 使用者從列表中選擇一筆欲查看或修改的收貨單。
    * 系統載入該筆收貨單的完整資料並顯示在表單上。
    * 使用者進行必要的修改後，點擊「儲存」。
    * 系統驗證並更新資料。
5.  **作廢流程**：
    * 使用者從查詢結果中選擇一筆狀態為「暫存」的收貨單。
    * 使用者點擊「作廢」按鈕。
    * 系統跳出確認對話框。
    * 使用者確認後，系統將該筆收貨單的狀態更新為「已作廢」，而非直接刪除紀錄，以保留操作軌跡。
6.  **結束**：完成所有操作。

### Mermaid 語法

```mermaid
---
title: 1.1.1. 收貨單維護作業流程圖
---
flowchart TD
    subgraph 倉管人員
        A1("開始: 進入<br>收貨單維護作業")
        A2{選擇操作}
        
        A3["輸入查詢條件"]
        A4["點擊「查詢」"]

        A5["從列表中選擇<br>一筆收貨單"]
        A6{要修改或作廢？}
        
        A7["修改表頭或<br>明細資料"]
        A8["點擊「儲存」"]

        A9["點擊「作廢」"]
        A10{確認作廢？}

        A11["點擊「新增」"]
        A12["填寫表頭資訊<br>(供應商、專案...)"]
        A13["新增並填寫明細<br>(物料、數量、儲位...)"]
        A14["點擊「儲存」"]
    end

    subgraph 系統
        B1["提供查詢條件<br>輸入欄位"]
        B2["根據條件<br>顯示收貨單列表"]
        B3["載入該筆<br>收貨單資料"]
        B4{資料驗證<br>成功？}
        B5["更新資料庫紀錄"]
        B6["顯示成功訊息"]
        B7["顯示錯誤訊息"]
        
        B8["顯示確認對話框"]
        B9["更新單據狀態<br>為「已作廢」"]
        
        B10["顯示空白<br>收貨單表單"]
        B11{資料驗證<br>成功？}
        B12["產生收貨單號"]
        B13["將資料存入資料庫<br>(Inventory.GoodsReceiptHeaders/Lines)<br>狀態: 暫存"]
    end
    
    %% 流程連結
    A1 --> A2

    A2 -- "查詢/修改/作廢" --> B1
    B1 --> A3
    A3 --> A4
    A4 --> B2
    B2 --> A5
    A5 --> A6

    A6 -- "修改" --> B3
    B3 --> A7
    A7 --> A8
    A8 --> B4
    B4 -- "是" --> B5 --> B6
    B4 -- "否" --> B7

    A6 -- "作廢" --> A9
    A9 --> B8
    B8 --> A10
    A10 -- "是" --> B9 --> B6

    A2 -- "新增收貨單" --> A11
    A11 --> B10
    B10 --> A12
    A12 --> A13
    A13 --> A14
    A14 --> B11
    B11 -- "是" --> B12 --> B13 --> B6
    B11 -- "否" --> B7

    B6 --> Z(結束)
    B7 --> A1
    A10 -- "否" --> A1