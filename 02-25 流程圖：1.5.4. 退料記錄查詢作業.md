# 流程圖：1.5.4. 退料記錄查詢作業

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：1.5. 退貨入庫
* **文件狀態**：流程圖語法已更新為 Mermaid。

---

這份流程圖詳細描述了任何有權限的使用者，在系統中查詢歷史專案退料紀錄的完整操作步驟。

### 流程圖說明

1.  **開始**：流程由使用者進入「退料記錄查詢作業」功能頁面開始。
2.  **輸入查詢條件**：
    * 系統提供多維度的查詢欄位，例如：退料單號、專案、案場、退料日期區間、物料編號/名稱等。
    * 使用者根據需求，輸入一個或多個查詢條件。
3.  **執行查詢**：
    * 使用者點擊「查詢」按鈕。
    * 系統會根據條件，到 `Inventory.InternalReturnHeaders` 與 `Inventory.InternalReturnLines` 等相關資料表中撈取符合的資料。
4.  **顯示結果**：
    * 系統以列表形式呈現所有符合條件的退料單記錄。
    * 使用者可以點擊任一筆紀錄，查看該退料單的完整詳細資訊，包含表頭與所有明細項目。
5.  **匯出報表 (可選)**：
    * 系統可提供「匯出」功能，讓使用者將查詢結果（列表或明細）匯出成 Excel 或 PDF 檔案，以利於線下分析或存檔。
6.  **結束**：完成查詢作業。

### Mermaid 語法

```mermaid
---
title: 1.5.4. 退料記錄查詢作業流程圖
---
flowchart TD
    %% Node Definitions
    subgraph 使用者
        A1("開始: 進入<br>退料記錄查詢作業")
        A2("輸入查詢條件")
        A3("點擊「查詢」")
        A4{要查看明細？}
        A5{要匯出報表？}
    end

    subgraph 系統
        B1["提供多維度查詢欄位<br>(如：退料單號、專案、日期...)"]
        B2["以列表形式顯示<br>符合的退料紀錄"]
        B3["顯示該筆退料單的<br>完整資訊"]
        B4["產生 Excel 或 PDF 檔案"]
    end

    %% Link Definitions
    A1 --> B1
    B1 --> A2
    A2 --> A3
    A3 --> B2
    
    B2 --> A4
    A4 -- "是" --> B3
    A4 -- "否" --> A5
    
    B3 --> A5
    A5 -- "是" --> B4
    A5 -- "否" --> Z(結束)
    
    B4 --> Z