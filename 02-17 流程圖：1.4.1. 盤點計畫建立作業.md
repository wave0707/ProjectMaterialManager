# 流程圖：1.4.1. 盤點計畫建立作業

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：1.4. 庫存盤點
* **文件狀態**：流程圖語法已更新為 Mermaid。

---

這份流程圖詳細描述了倉管主管或權責人員，為了進行庫存盤點，而在系統中預先建立盤點計畫的完整操作步驟。

### 流程圖說明

1.  **開始**：流程由倉管主管進入「盤點計畫建立作業」功能頁面開始。
2.  **建立盤點計畫**：
    * 主管點擊「新增計畫」按鈕。
3.  **定義盤點範圍與類型**：
    * **表頭**：主管需填寫計畫的基本資訊，如「計畫盤點日期」、「盤點類型」（例如：年度盤點、循環盤點、專案盤點）。
    * **範圍**：接著，定義此次盤點的範圍。這可以是：
        * 整個倉庫
        * 特定專案的所有物料
        * 特定儲區或儲位
        * 特定物料（常用於循環盤點）
4.  **提交計畫**：
    * 確認所有設定無誤後，主管點擊「建立計畫」。
5.  **系統處理**：
    * 系統會先驗證資料的完整性。
    * 驗證通過後，系統會：
        * 自動產生一組唯一的「盤點計畫單號 (`CountPlanNumber`)」。
        * 將計畫表頭資訊存入 `Inventory.CountPlanHeaders` 資料表。
        * 根據定義的盤點範圍，自動產生需要盤點的項目明細，並存入 `Inventory.CountPlanLines` 資料表。
        * 將該筆計畫的 `Status` (狀態) 設為「計畫中」。
6.  **結束**：盤點計畫成功建立，後續可依此計畫產生「盤點清單」供盤點人員使用。

### Mermaid 語法

```mermaid
---
title: 1.4.1. 盤點計畫建立作業流程圖
---
flowchart TD
    %% Node Definitions
    subgraph 倉管主管
        A1("開始: 進入<br>盤點計畫建立作業")
        A2("點擊「新增計畫」")
        A3("填寫計畫表頭資訊<br>(如：計畫日期、盤點類型)")
        A4("定義盤點範圍<br>(如：倉庫、專案、儲位、物料)")
        A5("點擊「建立計畫」")
    end

    subgraph 系統
        B1{資料驗證成功？}
        C1("產生盤點計畫單號")
        C2("儲存盤點計畫主檔<br>(Inventory.CountPlanHeaders)")
        C3("根據範圍自動生成盤點明細<br>(Inventory.CountPlanLines)")
        C4("更新計畫狀態為「計畫中」")
        B2("顯示「計畫建立成功」訊息")
        B3("顯示錯誤訊息")
    end

    %% Link Definitions
    A1 --> A2 --> A3 --> A4 --> A5 --> B1
    
    B1 -- "是" --> C1
    C1 --> C2
    C2 --> C3
    C3 --> C4
    C4 --> B2
    B2 --> Z(結束)
    
    B1 -- "否" --> B3
    B3 --> A1