# 流程圖：3.1. 專案主檔維護作業 (包含案場管理)

* **文件版本**: 1.0
* **制定日期**: 2025年7月5日
* **制定者**: William He
* **模組**：3. 專案管理
* **文件狀態**：流程圖語法已更新為 Mermaid。

---

這份流程圖詳細描述了權責人員（如：專案經理、管理部門）在系統中建立、查詢、修改專案主檔，以及管理其下屬案場的完整操作步驟。

### 流程圖說明

1.  **開始**：流程由使用者進入「專案主檔維護作業」功能頁面開始。
2.  **查詢/修改流程**：
    * 使用者可透過「專案編號」、「專案名稱」、「專案經理」等條件查詢。
    * 系統顯示符合條件的專案列表。
    * 使用者選擇任一筆專案，進入該專案的管理頁面。
    * **專案管理頁面**：
        * 在此頁面，使用者可以「修改專案基本資料」，也可以進入「案場管理」的區塊。
        * **案場管理**：使用者可以新增、修改或停用該專案下的案場 (`Project.Sites`)。新增案場時，系統會自動生成唯一的「案場編號」。
3.  **新增專案流程**：
    * 使用者點擊「新增專案」按鈕。
    * 使用者需填寫專案的完整資料，如專案名稱、專案經理、專案類型、預算、期程等。
    * 使用者填寫完所有資訊後，點擊「儲存」。
4.  **系統處理 (新增)**：
    * 系統進行資料驗證。
    * 驗證通過後，系統會：
        * 根據編碼原則（[專案類型碼]-[年份]-[流水號]），**自動生成唯一的「專案編號 (`ProjectCode`)」**。
        * 將新的專案資料存入 `Project.Projects` 資料表。
5.  **結束**：專案或案場主檔成功建立或更新。

### Mermaid 語法

```mermaid
---
title: 3.1. 專案主檔維護作業流程圖
---
flowchart TD
    %% Node Definitions
    subgraph 使用者
        A1("開始: 進入<br>專案主檔維護")
        A2{要新增專案？}

        A3("輸入查詢條件")
        A4("點擊「查詢」")
        A5("從列表中選擇一筆專案")
        A6{選擇操作?}
        A7("修改專案資料後<br>點擊「儲存」")

        A8{要新增案場？}
        A9("點擊「新增案場」")
        A10("填寫案場資料")
        A11("選擇一筆案場<br>進行修改")
        A12("修改後儲存")

        A13("點擊「新增專案」")
        A14("填寫專案基本資料<br>(名稱、經理、類型、預算等)")
        A15("點擊「儲存」")
    end

    subgraph 系統
        B1("顯示符合條件的<br>專案列表")
        B2("載入該專案的<br>詳細資料頁面")
        B3("驗證並更新資料庫")
        
        B4("顯示此專案下的<br>案場列表")
        B6["根據規則生成「案場編號」<br>並將資料存入 Project.Sites 表"]
        B7("載入案場資料")
        B8("更新案場資料")

        B9{資料驗證成功？}
        B11("顯示錯誤訊息")

        C1["根據編碼原則<br>自動生成「專案編號」"]
        C2["將資料存入<br>Project.Projects 表"]
        B10("顯示「建立成功」訊息")
    end

    %% Link Definitions
    A1 --> A2
    
    %% Query/Modify Path
    A2 -- "否，查詢/修改" --> A3 --> A4 --> B1 --> A5 --> B2 --> A6
    A6 -- "修改專案資料" --> A7 --> B3 --> Z(結束)
    A6 -- "管理案場" --> B4 --> A8
    
    %% Site Management Path
    A8 -- "是" --> A9 --> A10 --> B6 --> B4
    A8 -- "否，修改案場" --> A11 --> B7 --> A12 --> B8 --> B4

    %% New Project Path
    A2 -- "是" --> A13 --> A14 --> A15 --> B9
    B9 -- "是" --> C1 --> C2 --> B10 --> Z
    B9 -- "否" --> B11 --> A13